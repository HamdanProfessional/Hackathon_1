"use strict";(globalThis.webpackChunkai_robotics_web=globalThis.webpackChunkai_robotics_web||[]).push([[401],{8758:(e,t,n)=>{n.d(t,{A:()=>k});var o=n(6540),r=n(6347),l=n(3183),s=n(6295),i=n(4585);const a="personalizeContainer_E1tc",c="personalizeBtn_q3D7",d="active_cpld",p="icon_KHpf",u="loading_tzAi",m="spinner_TO2p",g="error_Xsxr",h="errorIcon_Crdl",f="dismissError_xjPz",w="personalizedContent_HPdS",v="contentWrapper_vVbO";var b=n(4848);const _=({onPersonalize:e})=>{const[t,n]=(0,o.useState)(!1),[l,_]=(0,o.useState)(!1),[x,y]=(0,o.useState)(null),[S,k]=(0,o.useState)(""),[$,z]=(0,o.useState)(""),[C,j]=(0,o.useState)("Beginner"),E=(0,r.zy)(),{data:N}=(0,i.wV)();(0,o.useEffect)(()=>{_(!1),y(null),k("")},[E.pathname]),(0,o.useEffect)(()=>{if(console.log("\ud83d\udd0d PersonalizeBtn - Session data:",{session:N,user:N?.user,hardware_bg:N?.user?.hardware_bg,skill_level:N?.user?.skill_level}),N?.user?.hardware_bg){const e=N.user.hardware_bg;console.log("\u2705 Setting hardware from session:",e),z(e)}else{const e=localStorage.getItem("user_hardware_bg")||"Laptop CPU";console.log("\u26a0\ufe0f No hardware in session, using fallback:",e),z(e)}if(N?.user?.skill_level){const e=N.user.skill_level;console.log("\u2705 Setting skill level from session:",e),j(e)}else{const e=localStorage.getItem("user_skill_level")||"Beginner";console.log("\u26a0\ufe0f No skill level in session, using fallback:",e),j(e)}},[N]);const A=e=>{try{const t=["article",'[role="main"]',".docMainContainer",".markdown"];let n=null;for(const e of t)if(n=document.querySelector(e),n)break;if(!n)return void console.warn("Could not find article content element to update");const o=document.createElement("div");o.className=w,o.setAttribute("data-personalized","true");const r=function(e){let t=e;const n=/<script|<iframe|<object|<embed|javascript:/gi;n.test(t)&&(console.warn("Potentially dangerous HTML detected, sanitizing..."),t=t.replace(n,""));return t=t.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,t,n)=>`<pre><code class="language-${t||"text"}">${function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;"};return e.replace(/[&<>]/g,e=>t[e])}(n.trim())}</code></pre>`),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/^### (.*$)/gim,"<h3>$1</h3>"),t=t.replace(/^## (.*$)/gim,"<h2>$1</h2>"),t=t.replace(/^# (.*$)/gim,"<h1>$1</h1>"),t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/_(.+?)_/g,"<em>$1</em>"),t=t.replace(/^\* (.+)$/gim,"<li>$1</li>"),t=t.replace(/^- (.+)$/gim,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),t=t.replace(/^\d+\. (.+)$/gim,"<li>$1</li>"),t=t.split("\n\n").map(e=>e.trim()?e.startsWith("<")?e:`<p>${e.trim()}</p>`:"").join("\n"),t=t.replace(/\n/g,"<br>"),t}(e);o.innerHTML=`<div class="${v}">${r}</div>`;const l=n.querySelector(".theme-doc-markdown")||n.querySelector("article > div")||n,s=l.querySelector("h1, h2");l.querySelectorAll(':scope > p, :scope > ul, :scope > ol, :scope > pre, :scope > blockquote, :scope > h3, :scope > h4, :scope > h5, :scope > h6, :scope > div:not([class*="theme-"]):not([class*="docusaurus"]):not([data-personalized])').forEach(e=>{const t=window.getComputedStyle(e).display;e.setAttribute("data-original-display",t),e.style.display="none"}),s&&s.parentNode?s.parentNode.insertBefore(o,s.nextSibling):l.insertBefore(o,l.firstChild)}catch(t){console.error("Error updating DOM with personalized content:",t)}};return N?.user&&$&&"Unknown"!==$?(0,b.jsxs)("div",{className:a,children:[(0,b.jsx)("button",{className:`${c} ${l?d:""}`,onClick:async()=>{if(l)return(()=>{try{const e=["article",'[role="main"]',".docMainContainer",".markdown"];let t=null;for(const o of e)if(t=document.querySelector(o),t)break;if(!t)return;const n=t.querySelector('[data-personalized="true"]');n&&n.remove(),document.querySelectorAll("[data-original-display]").forEach(e=>{const t=e.getAttribute("data-original-display")||"block";e.style.display="none"===t?"block":t,e.removeAttribute("data-original-display")})}catch(e){console.error("Error restoring original content:",e)}})(),void _(!1);const t=(()=>{try{const e=["article",'[role="main"]',".docMainContainer",".markdown"];let t=null;for(const o of e)if(t=document.querySelector(o),t)break;if(!t)return console.warn("Could not find article content element"),null;const n=t.cloneNode(!0);return n.querySelectorAll("button, nav, .toc, .docusaurus-mt-lg, .pagination").forEach(e=>e.remove()),n.innerText||n.textContent||""}catch(e){return console.error("Error extracting content from DOM:",e),null}})();if(t){k(t),n(!0),y(null);try{const n=await s.u.personalize(t,$,C);if(!n.data||200!==n.status)throw new Error(n.error||"Failed to personalize content");const o=n.data.personalized_content||n.data.response;if(!o||0===o.trim().length)throw new Error("Received empty response from server");if(o.startsWith("Unable to personalize"))throw new Error(o.replace("Unable to personalize content: ",""));A(o),_(!0),e&&e(o)}catch(o){const e=o instanceof Error?o.message:"Unknown error occurred";y(`Personalization failed: ${e}`),console.error("Personalization error:",o)}finally{n(!1)}}else y("Could not extract chapter content. Please try again.")},disabled:t,title:l?"Show original content":`Personalize for ${$} (${C})`,children:t?(0,b.jsxs)("span",{className:u,children:[(0,b.jsx)("span",{className:m,children:"\u23f3"})," Personalizing..."]}):l?(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:p,children:"\u2713"})," View Original"]}):(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:p,children:"\ud83d\udd27"})," Personalize for Me"]})}),x&&(0,b.jsxs)("div",{className:g,children:[(0,b.jsx)("span",{className:h,children:"\u26a0\ufe0f"}),x,(0,b.jsx)("button",{className:f,onClick:()=>y(null),"aria-label":"Dismiss error",children:"\u2715"})]})]}):null};var x=n(2832),y=n(152);const S={docItemWrapper:"docItemWrapper_EI_X",personalizeSection:"personalizeSection_J2n8",mainContent:"mainContent_QMqw",selectionTooltip:"selectionTooltip_LMjH",fadeIn:"fadeIn_Gy1L",tooltipButton:"tooltipButton_sfhm"};function k(e){(0,r.zy)();const{addContext:t,setIsChatOpen:n}=(0,y.v)(),[s,i]=(0,o.useState)({visible:!1,x:0,y:0,text:""}),a=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=()=>{i(e=>({...e,visible:!1}))},t=e=>{a.current&&!a.current.contains(e.target)&&i(e=>({...e,visible:!1}))};return window.addEventListener("scroll",e,!0),window.addEventListener("click",t),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("click",t)}},[]),(0,b.jsx)(l.A,{...e,children:(0,b.jsxs)("div",{className:S.docItemWrapper,children:[(0,b.jsx)("div",{className:S.personalizeSection,children:(0,b.jsx)(_,{})}),(0,b.jsx)("div",{ref:a,className:S.mainContent,onMouseUp:()=>{if("undefined"==typeof window)return;const e=window.getSelection(),t=e?.toString().trim();if(t&&t.length>0){const n=e?.getRangeAt(0),o=n?.getBoundingClientRect();o&&i({visible:!0,x:o.left+o.width/2,y:o.top-10,text:t})}else i(e=>({...e,visible:!1}))},children:e.children}),s.visible&&(0,b.jsx)("div",{className:S.selectionTooltip,style:{left:`${s.x}px`,top:`${s.y}px`},children:(0,b.jsx)("button",{className:S.tooltipButton,onClick:()=>{s.text&&(t(s.text),n(!0),i({visible:!1,x:0,y:0,text:""}),"undefined"!=typeof window&&window.getSelection()?.removeAllRanges())},title:"Add selected text to chat",children:"\ud83d\udcac Add to Chat"})}),(0,b.jsx)(x.J,{})]})})}}}]);