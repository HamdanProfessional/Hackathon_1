"use strict";(globalThis.webpackChunkai_robotics_web=globalThis.webpackChunkai_robotics_web||[]).push([[401],{5779:(e,t,r)=>{r.d(t,{A:()=>S});var n=r(6540),o=r(6347),s=r(3183);class a{tokenKey="session_token";constructor(e="http://localhost:8000",t="http://localhost:3001"){this.pythonBaseUrl=e,this.authBaseUrl=t}getToken(){return"undefined"==typeof window?null:localStorage.getItem(this.tokenKey)}setToken(e){"undefined"!=typeof window&&localStorage.setItem(this.tokenKey,e)}clearToken(){"undefined"!=typeof window&&localStorage.removeItem(this.tokenKey)}async fetchWithInterceptors(e,t={}){const{method:r="GET",headers:n={},body:o,includeToken:s=!0}=t,a={"Content-Type":"application/json",...n};if(s){const e=this.getToken();e&&(a.Authorization=`Bearer ${e}`)}const i={method:r,headers:a};!o||"POST"!==r&&"PUT"!==r&&"PATCH"!==r||(i.body=JSON.stringify(o));const l=await fetch(e,i);return 401===l.status&&(this.clearToken(),"undefined"!=typeof window&&window.location.pathname),l}async getApi(e,t){try{const r=`${this.pythonBaseUrl}${e}`,n=await this.fetchWithInterceptors(r,{...t,method:"GET"}),o=await n.json();return{status:n.status,data:n.ok?o:null,error:n.ok?void 0:o?.error||n.statusText}}catch(r){return{status:500,data:null,error:r instanceof Error?r.message:"Unknown error"}}}async postApi(e,t,r){try{const n=`${this.pythonBaseUrl}${e}`,o=await this.fetchWithInterceptors(n,{...r,method:"POST",body:t}),s=await o.json();return{status:o.status,data:o.ok?s:null,error:o.ok?void 0:s?.error||o.statusText}}catch(n){return{status:500,data:null,error:n instanceof Error?n.message:"Unknown error"}}}async putApi(e,t,r){try{const n=`${this.pythonBaseUrl}${e}`,o=await this.fetchWithInterceptors(n,{...r,method:"PUT",body:t}),s=await o.json();return{status:o.status,data:o.ok?s:null,error:o.ok?void 0:s?.error||o.statusText}}catch(n){return{status:500,data:null,error:n instanceof Error?n.message:"Unknown error"}}}async deleteApi(e,t){try{const r=`${this.pythonBaseUrl}${e}`,n=await this.fetchWithInterceptors(r,{...t,method:"DELETE"}),o=204!==n.status?await n.json():null;return{status:n.status,data:n.ok?o:null,error:n.ok?void 0:o?.error||n.statusText}}catch(r){return{status:500,data:null,error:r instanceof Error?r.message:"Unknown error"}}}async getAuth(e,t){try{const r=`${this.authBaseUrl}${e}`,n=await this.fetchWithInterceptors(r,{...t,method:"GET"}),o=await n.json();return{status:n.status,data:n.ok?o:null,error:n.ok?void 0:o?.error||n.statusText}}catch(r){return{status:500,data:null,error:r instanceof Error?r.message:"Unknown error"}}}async postAuth(e,t,r){try{const n=`${this.authBaseUrl}${e}`,o=await this.fetchWithInterceptors(n,{...r,method:"POST",body:t}),s=await o.json();return{status:o.status,data:o.ok?s:null,error:o.ok?void 0:s?.error||o.statusText}}catch(n){return{status:500,data:null,error:n instanceof Error?n.message:"Unknown error"}}}async chat(e,t){return this.postApi("/chat",{message:e,history:t})}async personalize(e,t,r="Beginner"){return this.postApi("/personalize",{content:e,hardware_bg:t,skill_level:r})}async healthCheck(){return this.getApi("/api/health")}}const i=new a;var l=r(4585);const c="personalizeContainer_E1tc",d="personalizeBtn_q3D7",u="active_cpld",h="icon_KHpf",p="loading_tzAi",m="spinner_TO2p",g="error_Xsxr",f="errorIcon_Crdl",w="dismissError_xjPz",y="personalizedContent_HPdS",k="contentWrapper_vVbO";var v=r(4848);const b=({onPersonalize:e})=>{const[t,r]=(0,n.useState)(!1),[s,a]=(0,n.useState)(!1),[b,x]=(0,n.useState)(null),[_,$]=(0,n.useState)(""),[S,E]=(0,n.useState)(""),[T,j]=(0,n.useState)("Beginner"),z=(0,o.zy)(),{data:C}=(0,l.wV)();(0,n.useEffect)(()=>{a(!1),x(null),$("")},[z.pathname]),(0,n.useEffect)(()=>{if(console.log("\ud83d\udd0d PersonalizeBtn - Session data:",{session:C,user:C?.user,hardware_bg:C?.user?.hardware_bg,skill_level:C?.user?.skill_level}),C?.user?.hardware_bg){const e=C.user.hardware_bg;console.log("\u2705 Setting hardware from session:",e),E(e)}else{const e=localStorage.getItem("user_hardware_bg")||"Laptop CPU";console.log("\u26a0\ufe0f No hardware in session, using fallback:",e),E(e)}if(C?.user?.skill_level){const e=C.user.skill_level;console.log("\u2705 Setting skill level from session:",e),j(e)}else{const e=localStorage.getItem("user_skill_level")||"Beginner";console.log("\u26a0\ufe0f No skill level in session, using fallback:",e),j(e)}},[C]);const A=e=>{try{const t=["article",'[role="main"]',".docMainContainer",".markdown"];let r=null;for(const e of t)if(r=document.querySelector(e),r)break;if(!r)return void console.warn("Could not find article content element to update");const n=document.createElement("div");n.className=y,n.setAttribute("data-personalized","true");const o=function(e){let t=e;const r=/<script|<iframe|<object|<embed|javascript:/gi;r.test(t)&&(console.warn("Potentially dangerous HTML detected, sanitizing..."),t=t.replace(r,""));return t=t.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,t,r)=>`<pre><code class="language-${t||"text"}">${function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;"};return e.replace(/[&<>]/g,e=>t[e])}(r.trim())}</code></pre>`),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/^### (.*$)/gim,"<h3>$1</h3>"),t=t.replace(/^## (.*$)/gim,"<h2>$1</h2>"),t=t.replace(/^# (.*$)/gim,"<h1>$1</h1>"),t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/_(.+?)_/g,"<em>$1</em>"),t=t.replace(/^\* (.+)$/gim,"<li>$1</li>"),t=t.replace(/^- (.+)$/gim,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),t=t.replace(/^\d+\. (.+)$/gim,"<li>$1</li>"),t=t.split("\n\n").map(e=>e.trim()?e.startsWith("<")?e:`<p>${e.trim()}</p>`:"").join("\n"),t=t.replace(/\n/g,"<br>"),t}(e);n.innerHTML=`<div class="${k}">${o}</div>`;const s=r.querySelector(".theme-doc-markdown")||r.querySelector("article > div")||r,a=s.querySelector("h1, h2");s.querySelectorAll(':scope > p, :scope > ul, :scope > ol, :scope > pre, :scope > blockquote, :scope > h3, :scope > h4, :scope > h5, :scope > h6, :scope > div:not([class*="theme-"]):not([class*="docusaurus"]):not([data-personalized])').forEach(e=>{const t=window.getComputedStyle(e).display;e.setAttribute("data-original-display",t),e.style.display="none"}),a&&a.parentNode?a.parentNode.insertBefore(n,a.nextSibling):s.insertBefore(n,s.firstChild)}catch(t){console.error("Error updating DOM with personalized content:",t)}};return C?.user&&S&&"Unknown"!==S?(0,v.jsxs)("div",{className:c,children:[(0,v.jsx)("button",{className:`${d} ${s?u:""}`,onClick:async()=>{if(s)return(()=>{try{const e=["article",'[role="main"]',".docMainContainer",".markdown"];let t=null;for(const n of e)if(t=document.querySelector(n),t)break;if(!t)return;const r=t.querySelector('[data-personalized="true"]');r&&r.remove(),document.querySelectorAll("[data-original-display]").forEach(e=>{const t=e.getAttribute("data-original-display")||"block";e.style.display="none"===t?"block":t,e.removeAttribute("data-original-display")})}catch(e){console.error("Error restoring original content:",e)}})(),void a(!1);const t=(()=>{try{const e=["article",'[role="main"]',".docMainContainer",".markdown"];let t=null;for(const n of e)if(t=document.querySelector(n),t)break;if(!t)return console.warn("Could not find article content element"),null;const r=t.cloneNode(!0);return r.querySelectorAll("button, nav, .toc, .docusaurus-mt-lg, .pagination").forEach(e=>e.remove()),r.innerText||r.textContent||""}catch(e){return console.error("Error extracting content from DOM:",e),null}})();if(t){$(t),r(!0),x(null);try{const r=await i.personalize(t,S,T);if(!r.data||200!==r.status)throw new Error(r.error||"Failed to personalize content");const n=r.data.personalized_content||r.data.response;if(!n||0===n.trim().length)throw new Error("Received empty response from server");if(n.startsWith("Unable to personalize"))throw new Error(n.replace("Unable to personalize content: ",""));A(n),a(!0),e&&e(n)}catch(n){const e=n instanceof Error?n.message:"Unknown error occurred";x(`Personalization failed: ${e}`),console.error("Personalization error:",n)}finally{r(!1)}}else x("Could not extract chapter content. Please try again.")},disabled:t,title:s?"Show original content":`Personalize for ${S} (${T})`,children:t?(0,v.jsxs)("span",{className:p,children:[(0,v.jsx)("span",{className:m,children:"\u23f3"})," Personalizing..."]}):s?(0,v.jsxs)("span",{children:[(0,v.jsx)("span",{className:h,children:"\u2713"})," View Original"]}):(0,v.jsxs)("span",{children:[(0,v.jsx)("span",{className:h,children:"\ud83d\udd27"})," Personalize for Me"]})}),b&&(0,v.jsxs)("div",{className:g,children:[(0,v.jsx)("span",{className:f,children:"\u26a0\ufe0f"}),b,(0,v.jsx)("button",{className:w,onClick:()=>x(null),"aria-label":"Dismiss error",children:"\u2715"})]})]}):null};var x=r(2832),_=r(152);const $={docItemWrapper:"docItemWrapper_EI_X",personalizeSection:"personalizeSection_J2n8",mainContent:"mainContent_QMqw",selectionTooltip:"selectionTooltip_LMjH",fadeIn:"fadeIn_Gy1L",tooltipButton:"tooltipButton_sfhm"};function S(e){(0,o.zy)();const{addContext:t,setIsChatOpen:r}=(0,_.v)(),[a,i]=(0,n.useState)({visible:!1,x:0,y:0,text:""}),l=(0,n.useRef)(null);return(0,n.useEffect)(()=>{const e=()=>{i(e=>({...e,visible:!1}))},t=e=>{l.current&&!l.current.contains(e.target)&&i(e=>({...e,visible:!1}))};return window.addEventListener("scroll",e,!0),window.addEventListener("click",t),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("click",t)}},[]),(0,v.jsx)(s.A,{...e,children:(0,v.jsxs)("div",{className:$.docItemWrapper,children:[(0,v.jsx)("div",{className:$.personalizeSection,children:(0,v.jsx)(b,{})}),(0,v.jsx)("div",{ref:l,className:$.mainContent,onMouseUp:()=>{if("undefined"==typeof window)return;const e=window.getSelection(),t=e?.toString().trim();if(t&&t.length>0){const r=e?.getRangeAt(0),n=r?.getBoundingClientRect();n&&i({visible:!0,x:n.left+n.width/2,y:n.top-10,text:t})}else i(e=>({...e,visible:!1}))},children:e.children}),a.visible&&(0,v.jsx)("div",{className:$.selectionTooltip,style:{left:`${a.x}px`,top:`${a.y}px`},children:(0,v.jsx)("button",{className:$.tooltipButton,onClick:()=>{a.text&&(t(a.text),r(!0),i({visible:!1,x:0,y:0,text:""}),"undefined"!=typeof window&&window.getSelection()?.removeAllRanges())},title:"Add selected text to chat",children:"\ud83d\udcac Add to Chat"})}),(0,v.jsx)(x.J,{})]})})}}}]);